<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dongrongyu.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Redis底层数据结构:  SDS: 简单动态字符串, simple dynamic string 链表 字典 跳跃表 整数集合 压缩列表  Redis的5种对象类型和底层数据结构的对应关系:    键类型 底层实现    字符串对象 SDS   列表对象 压缩列表 (元素长度短且元素数量少时), 双端链表   哈希对象 压缩列表 (少量键值对且每个键值对键和值是小整数值或长度比较短的字符串),">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis涉及与实现 - 数据结构与对象">
<meta property="og:url" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/index.html">
<meta property="og:site_name" content="Rongyu&#39;s BigHouse">
<meta property="og:description" content="Redis底层数据结构:  SDS: 简单动态字符串, simple dynamic string 链表 字典 跳跃表 整数集合 压缩列表  Redis的5种对象类型和底层数据结构的对应关系:    键类型 底层实现    字符串对象 SDS   列表对象 压缩列表 (元素长度短且元素数量少时), 双端链表   哈希对象 压缩列表 (少量键值对且每个键值对键和值是小整数值或长度比较短的字符串),">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220005705662.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220233615752.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220232954579.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220233103318.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210221234456492.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220234550734.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210221234415105.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220234445307.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220234521971.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222000803717.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222001104268.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222012539715.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222011545836.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222012556585.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210224004646363.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210224004656656.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210224005253997.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210225010124103.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210225010818422.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226002243394.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003249831.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226002559898.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003431546.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003456329.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003808306.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003940391.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226004231224.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226004248255.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227174824402.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227175048068.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227180908219.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227181005751.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227181758646.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227224940968.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227224959524.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227225500171.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227225509830.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227232410389.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227232456947.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227233523722.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227233842418.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227233929371.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227234333432.png">
<meta property="og:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210228002000143.png">
<meta property="article:published_time" content="2021-02-19T15:20:54.000Z">
<meta property="article:modified_time" content="2021-02-27T16:38:45.000Z">
<meta property="article:author" content="Rongyu">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220005705662.png">

<link rel="canonical" href="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Redis涉及与实现 - 数据结构与对象 | Rongyu's BigHouse</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rongyu's BigHouse</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dongrongyu.github.io/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Rongyu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rongyu's BigHouse">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis涉及与实现 - 数据结构与对象
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-19 23:20:54" itemprop="dateCreated datePublished" datetime="2021-02-19T23:20:54+08:00">2021-02-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-28 00:38:45" itemprop="dateModified" datetime="2021-02-28T00:38:45+08:00">2021-02-28</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Redis底层数据结构:</p>
<ul>
<li>SDS: 简单动态字符串, simple dynamic string</li>
<li>链表</li>
<li>字典</li>
<li>跳跃表</li>
<li>整数集合</li>
<li>压缩列表</li>
</ul>
<p>Redis的5种对象类型和底层数据结构的对应关系:</p>
<table>
<thead>
<tr>
<th>键类型</th>
<th>底层实现</th>
</tr>
</thead>
<tbody><tr>
<td>字符串对象</td>
<td>SDS</td>
</tr>
<tr>
<td>列表对象</td>
<td>压缩列表 (元素长度短且元素数量少时), 双端链表</td>
</tr>
<tr>
<td>哈希对象</td>
<td>压缩列表 (少量键值对且每个键值对键和值是小整数值或长度比较短的字符串), 字典</td>
</tr>
<tr>
<td>集合对象</td>
<td>整数集合 (元素均为整数值且数量不多时), 跳跃表</td>
</tr>
<tr>
<td>有序集合对象</td>
<td>压缩列表 (元素长度短且数量较少时), 跳跃表</td>
</tr>
</tbody></table>
<h1 id="SDS"><a href="#SDS" class="headerlink" title="SDS"></a>SDS</h1><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>simple dynamic string, 简单动态字符串</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220005705662.png" alt="image-20210220005705662"></p>
<p>sizeof(buf) = len + free + 1</p>
<h2 id="空间重分配"><a href="#空间重分配" class="headerlink" title="空间重分配"></a>空间重分配</h2><h3 id="空间预分配"><a href="#空间预分配" class="headerlink" title="空间预分配"></a>空间预分配</h3><p>SDS修改, 发生空间扩展</p>
<ul>
<li>扩展后 len &lt;  1MB: 预分配 free = len, sizeof(buf) = free + len + 1</li>
<li>扩展后 len &gt; 1MB: 预分配 free = 1MB, sizeof(buf) = len + free(1MB) + 1</li>
</ul>
<h3 id="惰性空间释放"><a href="#惰性空间释放" class="headerlink" title="惰性空间释放"></a>惰性空间释放</h3><p>SDS缩短时, 不立即释放空间.</p>
<p>SDS提供了相应的API, 在有需要时真正释放SDS</p>
<h3 id="二进制安全"><a href="#二进制安全" class="headerlink" title="二进制安全"></a>二进制安全</h3><p>通过len记录长度而不是‘\0’</p>
<h2 id="相比C字符串的优点"><a href="#相比C字符串的优点" class="headerlink" title="相比C字符串的优点"></a>相比C字符串的优点</h2><ul>
<li>常数复杂度获取字符串长度</li>
<li>杜绝缓冲区溢出</li>
<li>减少重分配次数</li>
<li>二进制安全</li>
<li>兼容部分C字符串函数</li>
</ul>
<h1 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h1><h2 id="结构-1"><a href="#结构-1" class="headerlink" title="结构"></a>结构</h2><p>双向链表</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220233615752.png" alt="image-20210220233615752"></p>
<h3 id="节点结构"><a href="#节点结构" class="headerlink" title="节点结构"></a>节点结构</h3><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220232954579.png" alt="image-20210220232954579"></p>
<h3 id="链表结构"><a href="#链表结构" class="headerlink" title="链表结构"></a>链表结构</h3><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220233103318.png" alt="image-20210220233103318"></p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>双端</li>
<li>无环</li>
<li>带表头和表尾指针</li>
<li>带链表长度计数器</li>
<li>多态: 值类型void* (可保存各种不同类型的值), dup、free、match函数可自定义</li>
</ul>
<h1 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h1><h2 id="结构-2"><a href="#结构-2" class="headerlink" title="结构"></a>结构</h2><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210221234456492.png" alt="image-20210221234456492"></p>
<h3 id="字典结构"><a href="#字典结构" class="headerlink" title="字典结构"></a>字典结构</h3><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220234550734.png" alt="image-20210220234550734"></p>
<p>dictType: 一簇用于操作特定类型键值对的函数, Redis为不同用途的字典设置不同类型的特定函数</p>
<p>privdata: 需要传给类型特定函数的可选参数</p>
<h4 id="dictType"><a href="#dictType" class="headerlink" title="dictType"></a>dictType</h4><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210221234415105.png" alt="image-20210221234415105"></p>
<h3 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h3><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220234445307.png" alt="image-20210220234445307"></p>
<h3 id="哈希表节点"><a href="#哈希表节点" class="headerlink" title="哈希表节点"></a>哈希表节点</h3><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210220234521971.png" alt="image-20210220234521971"></p>
<h2 id="rehash"><a href="#rehash" class="headerlink" title="rehash"></a>rehash</h2><p>为了让哈希表负载因子维持在一个合理范围, 字典可能进行扩展和收缩, 进行rehash</p>
<p>负载因子: load_factor = ht[0].used / ht[0].size</p>
<p>步骤:</p>
<ol>
<li>为ht[1]分配空间<ul>
<li>扩展: h[1]的大小为第一个大于等于ht[0].used*2的2^n</li>
<li>收缩: h[1]的大小为第一个大于等于ht[0].used的2^n</li>
</ul>
</li>
<li>h[0]的元素rehash到h[1]上</li>
<li>所有元素rehash完成后, 释放h[0], h[0] = h[1], h[1]创建一张空表</li>
</ol>
<p>扩展和收缩的条件:</p>
<ol>
<li>服务器没有执行BGSAVE或BGREWRITEAOF, 负载因子大于等于1</li>
<li>服务器在执行BGSAVE或BGREWRITEAOF, 负载因子大于等于5</li>
<li>负载因子小于0.1时执行收缩操作</li>
</ol>
<p>渐进式rehash:</p>
<ul>
<li>字典每次的添加、删除、查找、更新操作时, 将ht[0]中rehashidx索引上的键值对rehash到ht[1]中, 且rehashidx++</li>
<li>rehash完成时rehashidx设为-1</li>
<li>rehash的操作负载均摊到每个CRUD操作中, 避免单次计算量过大</li>
<li>rehash过程中的CUD操作会同时检索ht[0]和ht[1]</li>
</ul>
<h1 id="跳跃表"><a href="#跳跃表" class="headerlink" title="跳跃表"></a>跳跃表</h1><p>平均O(logN)、最坏O(N)的节点查找</p>
<h2 id="结构-3"><a href="#结构-3" class="headerlink" title="结构"></a>结构</h2><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222000803717.png" alt="image-20210222000803717"></p>
<p>level: 层数最大节点的层数</p>
<p>length: 跳跃表的长度, 表头节点不计</p>
<h3 id="zskiplistNode"><a href="#zskiplistNode" class="headerlink" title="zskiplistNode"></a>zskiplistNode</h3><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222001104268.png" alt="image-20210222001104268"></p>
<p>层: 每创建一个节点, 根绝幂次定律, 随机生成一个介于1~32的值最为level数组的大小, 也即层的高度</p>
<p>跨度: 两个节点之间的距离, 计算节点在跳跃表中的排位 (rank)</p>
<p>后退指针: 不指向表头节点</p>
<p>score: 用于节点间的比较. 多个节点<strong>可以相同</strong></p>
<p>obj: 指向一个字符串对象, 字符串对象保存一个SDS值. <strong>必须唯一</strong></p>
<h1 id="整数集合"><a href="#整数集合" class="headerlink" title="整数集合"></a>整数集合</h1><p>intset, 集合中不会重现重复元素</p>
<p>元素类型: int16_t、int32_t或int64_t</p>
<p>元素按从小到大的顺序在contents中存储</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222012539715.png" alt="image-20210222012539715"></p>
<h2 id="结构-4"><a href="#结构-4" class="headerlink" title="结构"></a>结构</h2><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222011545836.png" alt="image-20210222011545836"></p>
<p>encoding: INTSET_ENC_INT16, INTSET_ENC_INT32, INTSET_ENC_INT64</p>
<p>元素实际类型由encoding决定, 并不保存int8_t</p>
<h2 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h2><p>新元素类型比现有类型要大时, 需要升级</p>
<p>复杂度O(N)</p>
<p>步骤: </p>
<ol>
<li>根绝新元素类型, 扩展整数集合, 并为新元素分配空间</li>
<li>将所有元素转成和新元素相同类型, 从后往前放到新空间上</li>
<li>添加新元素</li>
<li>length++</li>
</ol>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210222012556585.png" alt="image-20210222012556585"></p>
<p>整数集合只支持升级不支持降级</p>
<h1 id="压缩列表"><a href="#压缩列表" class="headerlink" title="压缩列表"></a>压缩列表</h1><p>节省内存, 连续内存块组成的顺序型结构, 每个节点可以保存一个字节数组或者一个整数值</p>
<h2 id="结构-5"><a href="#结构-5" class="headerlink" title="结构"></a>结构</h2><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210224004646363.png" alt="image-20210224004646363"></p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210224004656656.png" alt="image-20210224004656656"></p>
<h3 id="节点结构-1"><a href="#节点结构-1" class="headerlink" title="节点结构"></a>节点结构</h3><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210224005253997.png" alt="image-20210224005253997"></p>
<h4 id="content"><a href="#content" class="headerlink" title="content"></a>content</h4><p>字节数组或者整数值 </p>
<ul>
<li><p>字节数组</p>
<ul>
<li>长度小于等于63 (2^6-1)的字节数组</li>
<li>长度小于等于16383 (2^14-1)</li>
<li>长度小于等于4294967295 (2^32-1)</li>
</ul>
</li>
<li><p>整数值</p>
<ul>
<li>4位长, 0~12间的无符号整数</li>
<li>1字节的有符号整数</li>
<li>3字节的有符号整数</li>
<li>int16_t</li>
<li>int32_t</li>
<li>Int64_t</li>
</ul>
</li>
</ul>
<h4 id="previous-entry-length"><a href="#previous-entry-length" class="headerlink" title="previous_entry_length"></a>previous_entry_length</h4><p>1字节或者5字节, 记录前一个节点的长度</p>
<ul>
<li>1字节: 前一个节点长度小于254</li>
<li>5字节: 前一个节点长度大于等于254, 第一个节点设置为0xFE (254), 之后四个字节保存长度</li>
</ul>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210225010124103.png" alt="image-20210225010124103"></p>
<p>前一个节点的起始地址 = 当前节点的起始地址 - previous_entry_length</p>
<p>利用该字段压缩列表可以实现从表尾向表头的遍历</p>
<h4 id="encoding"><a href="#encoding" class="headerlink" title="encoding"></a>encoding</h4><p>记录content保存数据的类型和长度</p>
<ul>
<li>字节数组编码: 1字节, 2字节或5字节, 最高位00, 01, 10开头</li>
<li>整数编码: 该字段1字节, 最高位以11开头, 类型和长度由剩余6位决定</li>
</ul>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210225010818422.png" alt="image-20210225010818422"></p>
<h2 id="连锁更新"><a href="#连锁更新" class="headerlink" title="连锁更新"></a>连锁更新</h2><p>添加和删除在特定情况下, 会引发所有节点长度的更新, 引发N次重分配, 每次重分配最坏复杂度位O(N), 所以连锁更新最坏复杂度位O(N^2)</p>
<ul>
<li><p>添加情况下的连锁更新: 所有节点e1~eN长度都为250~253字节之间, 在表头添加一个长度大于254的节点, 则所有节点都需要扩展</p>
</li>
<li><p>删除情况下的连锁更新: 节点排列big, small, e1~eN, e1~eN长度介于250~253, small小于254, big大于等于254. 删除small引发e1~eN的连锁更新</p>
</li>
</ul>
<h1 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h1><p>Redis对象种类: 字符串对象, 列表对象, 哈希对象, 集合对象, 有序集合对象</p>
<p>对象的实现基于前文的基本数据结构, 且同一个对象在不同场景可能会采取不同的底层结构</p>
<p>对象系统基于引用计数内存回收. 在适当条件下多个数据库建会共享同一快内存</p>
<p>对象带有访问时间记录</p>
<p>Redis键值对: 建对象 (字符串对象) + 值对象</p>
<h2 id="结构-6"><a href="#结构-6" class="headerlink" title="结构"></a>结构</h2><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226002243394.png" alt="image-20210226002243394"></p>
<p>键对象一定为字符串对象, 值对象可以为字符串对象, 列表对象, 哈希对象, 集合对象或者有序集合对象中的一种</p>
<h3 id="encoding-1"><a href="#encoding-1" class="headerlink" title="encoding"></a>encoding</h3><p>各个对象类型对应的底层实现:</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003249831.png" alt="image-20210226003249831"></p>
<p>对象类型 (TYPE命令的输出):</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226002559898.png" alt="image-20210226002559898"></p>
<p>编码对应的底层数据结构 (OBJECT ENCODING的输出):</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003431546.png" alt="image-20210226003431546"></p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003456329.png" alt="image-20210226003456329"></p>
<h2 id="字符串对象"><a href="#字符串对象" class="headerlink" title="字符串对象"></a>字符串对象</h2><h3 id="编码格式"><a href="#编码格式" class="headerlink" title="编码格式"></a>编码格式</h3><ul>
<li>int: 保存整数值, 且可以用long表示 (void*转换成long)<ul>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003808306.png" alt="image-20210226003808306"></li>
</ul>
</li>
<li>raw: 字符串值, 且长度大于32字节, 使用SDS存储<ul>
<li>两次内存分配, 分别分配redisObject和sdshdr结构</li>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226003940391.png" alt="image-20210226003940391"></li>
</ul>
</li>
<li>embstr: 字符串值, 且长度小于等于32字节<ul>
<li>一次内存分配, redisObject和sdshdr存储在一块连续的空间</li>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226004231224.png" alt="image-20210226004231224"></li>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210226004248255.png" alt="image-20210226004248255"></li>
</ul>
</li>
</ul>
<p>浮点数在Redis中也作为字符串存储, 且编码为embstr或raw</p>
<h3 id="编码转换"><a href="#编码转换" class="headerlink" title="编码转换"></a>编码转换</h3><p>转换方向:</p>
<ul>
<li><p>int -&gt; raw</p>
</li>
<li><p>embstr -&gt; raw</p>
</li>
</ul>
<p>转换情况:</p>
<ul>
<li>int值追加了字符串, int -&gt; raw</li>
<li>对embstr (只读)进行修改, embstr -&gt; raw</li>
</ul>
<h2 id="列表对象"><a href="#列表对象" class="headerlink" title="列表对象"></a>列表对象</h2><h3 id="编码格式-1"><a href="#编码格式-1" class="headerlink" title="编码格式"></a>编码格式</h3><ul>
<li><p>ziplist: 压缩列表, 每个entry存储一个列表元素</p>
<ul>
<li><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227174824402.png" alt="image-20210227174824402"></p>
<p>三个元素: 1, “three”, 5</p>
</li>
</ul>
</li>
<li><p>linkedlist: 双端链表</p>
<ul>
<li><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227175048068.png" alt="image-20210227175048068"></p>
<p>链表底层对象是字符串对象 (字符串对象是Redis五种类型对象中唯一一种可能被嵌套的对象类型)</p>
</li>
</ul>
</li>
</ul>
<h3 id="编码转换-1"><a href="#编码转换-1" class="headerlink" title="编码转换"></a>编码转换</h3><p>使用ziplist编码的情况:</p>
<ul>
<li>列表对象保存的所有字符串元素的长度都小于64字节</li>
<li>元素数量小于等于512个</li>
</ul>
<p>其他情况将转为使用linkedlist编码</p>
<h2 id="哈希对象"><a href="#哈希对象" class="headerlink" title="哈希对象"></a>哈希对象</h2><h3 id="编码格式-2"><a href="#编码格式-2" class="headerlink" title="编码格式"></a>编码格式</h3><ul>
<li><p>ziplist: 压缩列表. 键值对保存成两个entry存储在相邻位置</p>
<ul>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227180908219.png" alt="image-20210227180908219"></li>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227181005751.png" alt="image-20210227181005751"></li>
</ul>
</li>
<li><p>hashtable: 字典. 字典的</p>
<ul>
<li>键值对的键和值都是字符串对象</li>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227181758646.png" alt="image-20210227181758646"></li>
</ul>
</li>
</ul>
<h3 id="编码转换-2"><a href="#编码转换-2" class="headerlink" title="编码转换"></a>编码转换</h3><p>使用ziplist编码:</p>
<ul>
<li>所有键值对的键和值的字符串长度都小于64字节 (可配置hash-max-ziplist-value)</li>
<li>键值对数量小于等于512个 (可配置hash-max-ziplist-entries)</li>
</ul>
<p>其他情况转换为使用hashtable</p>
<h2 id="集合对象"><a href="#集合对象" class="headerlink" title="集合对象"></a>集合对象</h2><h3 id="编码格式-3"><a href="#编码格式-3" class="headerlink" title="编码格式"></a>编码格式</h3><ul>
<li>intset: 整数集合<ul>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227224940968.png" alt="image-20210227224940968"></li>
</ul>
</li>
<li>hashtable: 字典, 每个键是一个字符串对象, 值为NULL<ul>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227224959524.png" alt="image-20210227224959524"></li>
</ul>
</li>
</ul>
<h3 id="编码转换-3"><a href="#编码转换-3" class="headerlink" title="编码转换"></a>编码转换</h3><p>使用intset编码:</p>
<ul>
<li>所有元素都是整数值</li>
<li>元素数量不超过512个 (可配置set-max-intset-entries)</li>
</ul>
<p>其他情况则转换为hashtable</p>
<h2 id="有序集合对象"><a href="#有序集合对象" class="headerlink" title="有序集合对象"></a>有序集合对象</h2><h3 id="编码格式-4"><a href="#编码格式-4" class="headerlink" title="编码格式"></a>编码格式</h3><ul>
<li><p>ziplist: 压缩列表. 两个相邻节点来保存, 元素成员 + 分值</p>
<ul>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227225500171.png" alt="image-20210227225500171"></li>
<li><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227225509830.png" alt="image-20210227225509830"></li>
</ul>
</li>
<li><p>skiplist: 使用zset作为作为底层实现, zset包含一个字典和跳跃表. </p>
<ul>
<li><pre><code class="c">typedef struct zset &#123;
    zskiplist *zsl;
  dict *dict;
&#125;
</code></pre>
</li>
<li><p>zsl跳跃表: 节点object保存元素的成员, score保存了元素的分值</p>
</li>
<li><p>dict: 成员到分值的映射, O(1)复杂度查找成员的分值</p>
</li>
<li><p>zsl和dict通过指针共享相同元素的成员和分值 (分值是double应该是不需要共享的)</p>
</li>
<li><p>成员是字符串对象, 分值是一个double类型的浮点数</p>
</li>
<li><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227232410389.png" alt="image-20210227232410389"></p>
</li>
<li><p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227232456947.png" alt="image-20210227232456947"></p>
</li>
<li><p>上图中没有展现出共享成员, 实际上zsl和dict是共享成员的</p>
</li>
</ul>
</li>
</ul>
<h3 id="编码转换-4"><a href="#编码转换-4" class="headerlink" title="编码转换"></a>编码转换</h3><p>使用ziplist编码:</p>
<ul>
<li>所有元素长度都小于64字节 (zset-max-ziplist-value)</li>
<li>元素数量小于128个 (zset-max-ziplist-entries)</li>
</ul>
<p>其他情况转换为skiplist编码</p>
<h2 id="类型检查与命令多态"><a href="#类型检查与命令多态" class="headerlink" title="类型检查与命令多态"></a>类型检查与命令多态</h2><p>针对命令执行的对象命令可分为两种类型:</p>
<ul>
<li>通用命令: 对任何类型的键执行<ul>
<li>DEL, EXPIRE, RENAME</li>
</ul>
</li>
<li>类型特定命令: 一些命令只能对特定类型的键执行<ul>
<li>只能对字符串键执行: SET, GET, APPEND, STRLEN等</li>
<li>只能对哈希键执行: HDEL, HSET, HGET, HLEN等</li>
<li>只能对列表键执行: RPUSH, LPOP, LINSERT, LLEN等</li>
<li>集合键: SADD, SPOP, SINTER, SCARD等</li>
<li>有序集合键: ZADD, ZCARD, ZRANK, ZSCORE</li>
</ul>
</li>
</ul>
<h3 id="类型检查的实现"><a href="#类型检查的实现" class="headerlink" title="类型检查的实现"></a>类型检查的实现</h3><p>类型特定命令的类型检查是通过redisObject结构的type属性来实现的</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227233523722.png" alt="image-20210227233523722"></p>
<h3 id="多态命令的实现"><a href="#多态命令的实现" class="headerlink" title="多态命令的实现"></a>多态命令的实现</h3><p>多态命令类型:</p>
<ul>
<li>基于类型的多态: 一个命令能同时处理多种不同类型的键, 如DEL, EXPIRE, TYPE等</li>
<li>基于编码的多态: 一个命令能同时用于处理多种不同编码, 如LLEN等</li>
</ul>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227233842418.png" alt="image-20210227233842418"></p>
<h3 id="内存回收"><a href="#内存回收" class="headerlink" title="内存回收"></a>内存回收</h3><p>Reidis基于引用计数技术实现的内存回收</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227233929371.png" alt="image-20210227233929371"></p>
<p>引用计数变化形式:</p>
<ul>
<li>创建一个新对象, refcount = 1</li>
<li>对象被一个新程序使用, refcount++</li>
<li>对象不再被一个程序使用, refcount–</li>
<li>refcount == 0, 对象被释放</li>
</ul>
<h3 id="对象共享"><a href="#对象共享" class="headerlink" title="对象共享"></a>对象共享</h3><p>基于refcount实现对象共享.</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210227234333432.png" alt="image-20210227234333432"></p>
<p>Redis在初始化服务器时, 会创建一万个整数值字符串对象 (0~9999). (可修改redis.h/REDIS_SHARED_INTEGERS)</p>
<p>Redis支队包含整数值的字符串进行共享 (感觉应该也只有初始化的整形字符串对象才被共享)</p>
<h3 id="对象的空转时长"><a href="#对象的空转时长" class="headerlink" title="对象的空转时长"></a>对象的空转时长</h3><p>对象最后一次被命令访问的时间 = 当前时间 - lru时间</p>
<p><img src="/2021/02/19/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20210228002000143.png" alt="image-20210228002000143"></p>
<p>如果服务器打开了maxmemory选项, 且内存回收算法为volatile-lru或allkeys-lru, 那么空转时间较长的那部分键会优先被服务器释放</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Redis/" rel="tag"># Redis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/23/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-Chapter-11-14/" rel="prev" title="Redis设计与实现 Chapter 11-14">
      <i class="fa fa-chevron-left"></i> Redis设计与实现 Chapter 11-14
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/02/28/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0/" rel="next" title="Redis设计与实现-单机数据库的实现">
      Redis设计与实现-单机数据库的实现 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SDS"><span class="nav-number">1.</span> <span class="nav-text">SDS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84"><span class="nav-number">1.1.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A9%BA%E9%97%B4%E9%87%8D%E5%88%86%E9%85%8D"><span class="nav-number">1.2.</span> <span class="nav-text">空间重分配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A9%BA%E9%97%B4%E9%A2%84%E5%88%86%E9%85%8D"><span class="nav-number">1.2.1.</span> <span class="nav-text">空间预分配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%83%B0%E6%80%A7%E7%A9%BA%E9%97%B4%E9%87%8A%E6%94%BE"><span class="nav-number">1.2.2.</span> <span class="nav-text">惰性空间释放</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8"><span class="nav-number">1.2.3.</span> <span class="nav-text">二进制安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E6%AF%94C%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E4%BC%98%E7%82%B9"><span class="nav-number">1.3.</span> <span class="nav-text">相比C字符串的优点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%93%BE%E8%A1%A8"><span class="nav-number">2.</span> <span class="nav-text">链表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-1"><span class="nav-number">2.1.</span> <span class="nav-text">结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.1.</span> <span class="nav-text">节点结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.2.</span> <span class="nav-text">链表结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E6%80%A7"><span class="nav-number">2.1.3.</span> <span class="nav-text">特性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E5%85%B8"><span class="nav-number">3.</span> <span class="nav-text">字典</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-2"><span class="nav-number">3.1.</span> <span class="nav-text">结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E5%85%B8%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.1.</span> <span class="nav-text">字典结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#dictType"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">dictType</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="nav-number">3.1.2.</span> <span class="nav-text">哈希表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E8%8A%82%E7%82%B9"><span class="nav-number">3.1.3.</span> <span class="nav-text">哈希表节点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rehash"><span class="nav-number">3.2.</span> <span class="nav-text">rehash</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%B3%E8%B7%83%E8%A1%A8"><span class="nav-number">4.</span> <span class="nav-text">跳跃表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-3"><span class="nav-number">4.1.</span> <span class="nav-text">结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#zskiplistNode"><span class="nav-number">4.1.1.</span> <span class="nav-text">zskiplistNode</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88"><span class="nav-number">5.</span> <span class="nav-text">整数集合</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-4"><span class="nav-number">5.1.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%87%E7%BA%A7"><span class="nav-number">5.2.</span> <span class="nav-text">升级</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8"><span class="nav-number">6.</span> <span class="nav-text">压缩列表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-5"><span class="nav-number">6.1.</span> <span class="nav-text">结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E7%BB%93%E6%9E%84-1"><span class="nav-number">6.1.1.</span> <span class="nav-text">节点结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#content"><span class="nav-number">6.1.1.1.</span> <span class="nav-text">content</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#previous-entry-length"><span class="nav-number">6.1.1.2.</span> <span class="nav-text">previous_entry_length</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#encoding"><span class="nav-number">6.1.1.3.</span> <span class="nav-text">encoding</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E9%94%81%E6%9B%B4%E6%96%B0"><span class="nav-number">6.2.</span> <span class="nav-text">连锁更新</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.</span> <span class="nav-text">对象</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84-6"><span class="nav-number">7.1.</span> <span class="nav-text">结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#encoding-1"><span class="nav-number">7.1.1.</span> <span class="nav-text">encoding</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.2.</span> <span class="nav-text">字符串对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F"><span class="nav-number">7.2.1.</span> <span class="nav-text">编码格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2"><span class="nav-number">7.2.2.</span> <span class="nav-text">编码转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%97%E8%A1%A8%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.3.</span> <span class="nav-text">列表对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F-1"><span class="nav-number">7.3.1.</span> <span class="nav-text">编码格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2-1"><span class="nav-number">7.3.2.</span> <span class="nav-text">编码转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%88%E5%B8%8C%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.4.</span> <span class="nav-text">哈希对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F-2"><span class="nav-number">7.4.1.</span> <span class="nav-text">编码格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2-2"><span class="nav-number">7.4.2.</span> <span class="nav-text">编码转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.5.</span> <span class="nav-text">集合对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F-3"><span class="nav-number">7.5.1.</span> <span class="nav-text">编码格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2-3"><span class="nav-number">7.5.2.</span> <span class="nav-text">编码转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1"><span class="nav-number">7.6.</span> <span class="nav-text">有序集合对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F-4"><span class="nav-number">7.6.1.</span> <span class="nav-text">编码格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2-4"><span class="nav-number">7.6.2.</span> <span class="nav-text">编码转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E4%B8%8E%E5%91%BD%E4%BB%A4%E5%A4%9A%E6%80%81"><span class="nav-number">7.7.</span> <span class="nav-text">类型检查与命令多态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">7.7.1.</span> <span class="nav-text">类型检查的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%80%81%E5%91%BD%E4%BB%A4%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">7.7.2.</span> <span class="nav-text">多态命令的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6"><span class="nav-number">7.7.3.</span> <span class="nav-text">内存回收</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E5%85%B1%E4%BA%AB"><span class="nav-number">7.7.4.</span> <span class="nav-text">对象共享</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%A9%BA%E8%BD%AC%E6%97%B6%E9%95%BF"><span class="nav-number">7.7.5.</span> <span class="nav-text">对象的空转时长</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rongyu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Rongyu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dongrongyu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dongrongyu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:rongyu.dong@gmail.com" title="E-Mail → mailto:rongyu.dong@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rongyu</span>
</div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>



        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '3nDJCTt3PoQ9qeabywtgL5qQ-gzGzoHsz',
      appKey     : 'HMGLSYCgLRuL0Tst8VMocAfj',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
